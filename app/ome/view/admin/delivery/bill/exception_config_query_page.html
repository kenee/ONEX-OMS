<!--
  Copyright 2012-2026 ShopeX (https://www.shopex.cn)

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<div class="tableform">
  <div class="division">
    <table width="100%" cellspacing="0" cellpadding="0" border="0">
      <tbody>
        <tr>
          <th>选择店铺：</th>
          <td colspan="2">
            <select name="shop_id" id="shop_id" data-search="true" style="width: 300px;">
              <option value="">请选择店铺</option>
              <{foreach from=$shops item=shop}>
                <option value="<{$shop.shop_id}>"><{$shop.name}> (<{$shop.shop_bn}>)</option>
              <{/foreach}>
            </select>
          </td>
        </tr>
        <tr>
          <th>操作说明：</th>
          <td colspan="2">
            <p>选择店铺后点击"查询配置"按钮，将查询该店铺的预警配置信息。</p>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="tableform" id="config_result" style="margin-top: 20px;">
  <div class="division">
    <div style="padding: 30px; background-color: #f8f9fa; border: 1px solid #e9ecef; border-radius: 4px; text-align: center; color: #6c757d; min-height: 120px;">
      <p style="margin: 0; font-size: 14px;">查询结果将在这里显示</p>
      <p style="margin: 5px 0 0 0; font-size: 12px; color: #adb5bd;">点击"查询配置"按钮后，预警配置信息将显示在此区域</p>
    </div>
  </div>
</div>

<{area inject=".mainFoot"}>
<div class="table-action">
  <{button label="查询配置" class="btn-primary" id="queryConfig"}>
  <{button label="取消" class="btn-secondary" isCloseDialogBtn="true" }>
</div>
<{/area}>

<script>
// 查询按钮点击事件
$('queryConfig').addEvent('click', function(event) {
    var shop_id = $('shop_id').value;
    
    if (!shop_id) {
        MessageBox.error('请选择店铺');
        return;
    }
    
    // 显示加载状态
    $('queryConfig').set('disabled', 'true');
    $('queryConfig').set('text', '查询中...');
    
    // 使用W.page方式调用，指定更新config_result元素
    W.page('index.php?app=ome&ctl=admin_delivery_bill&act=doExceptionConfigQuery', {
        method: 'post',
        data: {
            shop_id: shop_id
        },
        update: $('config_result'),
        clearUpdateMap: false,
        onComplete: function(response) {
            $('queryConfig').set('disabled', '');
            $('queryConfig').set('text', '查询配置');
        }
    });
});

// 移除不再需要的displayConfigData函数

// 初始化tail.select组件
Ex_Loader("tail.select", function(){
    tail.select('#shop_id', {
        search: true,
        width: 300,
        height: 200,
        searchMinLength: 0,
        searchPlaceholder: '输入店铺名称或编号搜索',
        searchFocus: true,
        searchMark: true,
        searchMarkPlaceholder: '未找到匹配项'
    });
});
</script> 
<!--
  Copyright 2012-2026 ShopeX (https://www.shopex.cn)

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<form method="post" enctype="multipart/form-data" id="import_form" action="index.php?app=wms&ctl=admin_product_serial&act=doImport" class="tableform">
<h2 class="head-title">唯一码导入</h2>
<div id="information" class="division" style="display:none;">
    <div style="color:#ff0000;"><b>错误信息如下：</b></div>
    <div id="errorInfo" style="width:450px;height:150px;padding:5px;overflow-y:auto;line-height:150%;border:1px solid #999;"></div>
</div>
<br />
<h4><br />
<{t}>第一步：导出模板<{/t}>&nbsp;&nbsp;<{button class="btn-primary" id='export_tpl_csv' label="下载" type="button"}>
</h4>
<br />
<h4>
<br />
<{t}>第二步：上传您要导入的文件<{/t}>
</h4>
<div class="division">
<table cellpadding="0" cellspacing="0" border="0">
	<tr>
		<th><{t}>上传文件：<{/t}></th>
		<td><input type="file" name="import_file" /></td>
	</tr>
	<tr>
		<th>&nbsp;</th>
		<td><{button id="btn-submit" class="btn-primary" label="上传" type="button"}></td>
	</tr>
</table>
</div>
</form>

<script>
(function(){
	
	$('export_tpl_csv').addEvent('click',function(){
		window.open("index.php?app=wms&ctl=admin_product_serial&act=exportTemplate","_blank");
	});
	
	$('import_form').store('target',{
	    onComplete:function(jsontext){
	        var json = JSON.decode(jsontext);
	        if (json.result == 'succ'){
	        	MessageBox.success('上传成功');
                alert(json.msg);
	        }else{
		        MessageBox.error('唯一码导入失败！');
		        $('information').style.display ='';
		        var errorInfo = '';
		        for(var key=0; key<json['msg'].length;key++){
		            errorInfo = errorInfo + json['msg'][key] + '<br />';
		        }
		        $('errorInfo').set('html', errorInfo);
	        }
	    }
	});
	    
	$('btn-submit').addEvent('click',function(){
	    $('information').style.display ='none';
	    $('errorInfo').set('html', '');
	    $('import_form').fireEvent('submit',{stop:$empty});
	});

})();
</script>